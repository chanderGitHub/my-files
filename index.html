<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Shared Files</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8fafc;
      color: #333;
      margin: 40px;
    }
    h1 {
      color: #0066cc;
      margin-bottom: 25px;
    }
    ul {
      list-style-type: none;
      padding-left: 20px;
    }
    li {
      margin: 8px 0;
      font-size: 16px;
    }
    a {
      text-decoration: none;
      color: #0078d7;
    }
    a:hover {
      text-decoration: underline;
    }
    i {
      margin-right: 8px;
    }
    .folder {
      font-weight: bold;
      color: #222;
    }
    .meta {
      color: gray;
      font-size: 13px;
      margin-left: 8px;
    }
    .loading {
      color: gray;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h1>My Shared Files</h1>
  <ul id="file-list">
    <li class="loading">Loading files from repository...</li>
  </ul>

  <script>
    // Your GitHub username and repository name
    const username = "chanderGitHub";
    const repo = "my-files";
    const branch = "main";
    const apiBase = `https://api.github.com/repos/${username}/${repo}/contents/`;

    // Get file icon based on extension
    function getFileIcon(fileName) {
      if (fileName.match(/\.(doc|docx)$/i)) return '<i class="fa-solid fa-file-word" style="color:#2B579A;"></i>';
      if (fileName.match(/\.(xls|xlsx)$/i)) return '<i class="fa-solid fa-file-excel" style="color:#217346;"></i>';
      if (fileName.match(/\.(ppt|pptx)$/i)) return '<i class="fa-solid fa-file-powerpoint" style="color:#D24726;"></i>';
      if (fileName.match(/\.(pdf)$/i)) return '<i class="fa-solid fa-file-pdf" style="color:#B30B00;"></i>';
      if (fileName.match(/\.(txt|csv)$/i)) return '<i class="fa-solid fa-file-lines" style="color:#555;"></i>';
      if (fileName.match(/\.(jpg|jpeg|png|gif|bmp)$/i)) return '<i class="fa-solid fa-file-image" style="color:#F4B400;"></i>';
      return '<i class="fa-solid fa-file" style="color:#777;"></i>';
    }

    // Format bytes to readable units
    function formatSize(bytes) {
      if (bytes < 1024) return bytes + " B";
      let kb = bytes / 1024;
      if (kb < 1024) return kb.toFixed(1) + " KB";
      let mb = kb / 1024;
      return mb.toFixed(1) + " MB";
    }

    // Get last modified date via GitHub commits API
    async function getLastModified(path) {
      const commitApi = `https://api.github.com/repos/${username}/${repo}/commits?path=${path}&page=1&per_page=1`;
      try {
        const res = await fetch(commitApi);
        const commits = await res.json();
        if (commits && commits.length > 0) {
          return new Date(commits[0].commit.author.date).toLocaleDateString();
        }
      } catch (e) {
        console.warn("Error fetching commit info:", e);
      }
      return "—";
    }

    // Recursive folder loader
    async function loadFolder(path = "", parentElement) {
      const url = apiBase + path;
      const response = await fetch(url);
      const items = await response.json();

      // Sort: folders first
      items.sort((a, b) => a.type.localeCompare(b.type));

      for (const item of items) {
        const listItem = document.createElement('li');

        if (item.type === "dir") {
          listItem.innerHTML = `<i class="fa-solid fa-folder" style="color:#f4b400;"></i> <span class="folder">${item.name}</span>`;
          const sublist = document.createElement('ul');
          listItem.appendChild(sublist);
          parentElement.appendChild(listItem);
          await loadFolder(item.path, sublist);
        } else if (item.type === "file") {
          const fileName = item.name;
          const rawUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${item.path}`;
          const gviewUrl = `https://docs.google.com/gview?url=${rawUrl}&embedded=true`;

          let viewLink;
          if (fileName.match(/\.(docx|doc|xlsx|xls|ppt|pptx)$/i)) {
            viewLink = `<a href="${gviewUrl}" target="_blank">${fileName}</a>`;
          } else {
            viewLink = `<a href="${rawUrl}" target="_blank">${fileName}</a>`;
          }

          const icon = getFileIcon(fileName);
          const downloadLink = `<a href="${rawUrl}" download title="Download file">⬇️</a>`;
          const size = formatSize(item.size);
          const date = await getLastModified(item.path);

          listItem.innerHTML = `${icon} ${viewLink} &nbsp;${downloadLink}
            <span class="meta">(${size}, modified: ${date})</span>`;
          parentElement.appendChild(listItem);
        }
      }
    }

    // Initialize listing
    (async function init() {
      const fileList = document.getElementById('file-list');
      fileList.innerHTML = '';
      try {
        await loadFolder("", fileList);
      } catch (err) {
        console.error(err);
        fileList.innerHTML = `<li style="color:red;">⚠️ Error loading files. Check repository or API limit.</li>`;
      }
    })();
  </script>
</body>
</html>
